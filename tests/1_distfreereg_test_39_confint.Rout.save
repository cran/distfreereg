
R version 4.4.1 (2024-06-14 ucrt) -- "Race for Your Life"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(distfreereg)
> 
> # First, test a linear model.
> set.seed(20240816)
> n <- 1e2
> func <- function(x, theta) theta[1] + theta[2]*x[1] + theta[3]*x[2]
> Sig <- rexp(n) + 1
> theta <- c(2,5,-1)
> X <- matrix(rexp(2*n, rate = 1), nrow = n)
> Y <- distfreereg:::f2ftheta(f = func, X)(theta) + rnorm(n, sd = sqrt(Sig))
> 
> set.seed(20240816)
> dfr_1 <- distfreereg(Y = Y, X = X, test_mean = func, covariance = list(Sigma = Sig),
+                      theta_init = rep(1, length(theta)), verbose = FALSE)
> 
> confint_1 <- confint(dfr_1)
> confint_1
$ci
           2.5 %     97.5 %
theta1  1.448106  2.5237896
theta2  4.668497  5.2804156
theta3 -1.320729 -0.7233738

$vcov
            theta1       theta2       theta3
theta1  0.07530308 -0.029060421 -0.029720753
theta2 -0.02906042  0.024368662  0.004904737
theta3 -0.02972075  0.004904737  0.023222539

> 
> # Now compare to results from lm().
> df <- data.frame(a = X[,1], b = X[,2], c = Y)
> m <- lm(c ~ a + b, data = df, weights = dfr_1[["covariance"]][["P"]])
> dfr_2 <- distfreereg(test_mean = m, verbose = FALSE)
> all.equal(dfr_1[["theta_hat"]], dfr_2[["theta_hat"]], check.attributes = FALSE)
[1] TRUE
> 
> confint_2 <- confint(dfr_2)
> confint_2
                2.5 %     97.5 %
(Intercept)  1.466321  2.5055748
a            4.617972  5.3309401
b           -1.348177 -0.6959266
> 
> all.equal(confint_1[["ci"]], confint_2, check.attributes = FALSE)
[1] "Mean relative difference: 0.01204974"
> 
> 
> # Compare to results from using a matrix form for Sigma
> set.seed(20240816)
> dfr_3 <- distfreereg(Y = Y, X = X, test_mean = func, covariance = list(Sigma = diag(Sig)),
+                      theta_init = rep(1, length(theta)), verbose = FALSE)
> confint_3 <- confint(dfr_3)
> all.equal(confint_1, confint_3)
[1] TRUE
> 
> 
> 
> # Next, try a non-linear model
> set.seed(20240816)
> n <- 1e2
> func <- function(x, theta) theta[1] + x[1]^theta[2] + theta[3]*x[2]
> Sig <- rexp(n) + 1
> theta <- c(5,1,-1)
> X <- matrix(rexp(2*n, rate = 1), nrow = n)
> Y <- distfreereg:::f2ftheta(f = func, X)(theta) + rnorm(n, sd = sqrt(Sig))
> 
> set.seed(20240816)
> dfr_4 <- distfreereg(Y = Y, X = X, test_mean = func, covariance = list(Sigma = Sig),
+                      theta_init = rep(1, length(theta)), verbose = FALSE)
> 
> confint_4 <- confint(dfr_4)
> confint_4
$ci
            2.5 %     97.5 %
theta1  4.5264952  5.3630091
theta2  0.8634691  1.2708352
theta3 -1.3077089 -0.7160684

$vcov
             theta1       theta2       theta3
theta1  0.045539701 -0.007876431 -0.025524625
theta2 -0.007876431  0.010799747  0.002960208
theta3 -0.025524625  0.002960208  0.022780309

> 
> # Next, compare to results from nls().
> df <- data.frame(x1 = X[,1], x2 = X[,2], y = Y)
> m <- nls(y ~ k + x1^a + b*x2, data = df, weights = dfr_1[["covariance"]][["P"]])
Warning message:
In nls(y ~ k + x1^a + b * x2, data = df, weights = dfr_1[["covariance"]][["P"]]) :
  No starting values specified for some parameters.
Initializing 'k', 'a', 'b' to '1.'.
Consider specifying 'start' or using a selfStart model
> 
> dfr_5 <- distfreereg(test_mean = m, verbose = FALSE)
> all.equal(dfr_4[["theta_hat"]], dfr_5[["theta_hat"]], check.attributes = FALSE)
[1] "Mean relative difference: 3.128416e-05"
> 
> confint_5 <- confint(dfr_5)
> confint_5
       2.5 %     97.5 %
k  4.5412534  5.3483321
a  0.7889427  1.3455401
b -1.3355875 -0.6883695
> 
> all.equal(confint_4[["ci"]], confint_5, check.attributes = FALSE)
[1] "Mean relative difference: 0.01667503"
> 
> # Compare to results from using a matrix form for Sigma
> set.seed(20240816)
> dfr_6 <- distfreereg(Y = Y, X = X, test_mean = func, covariance = list(Sigma = diag(Sig)),
+                      theta_init = rep(1, length(theta)), verbose = FALSE)
> confint_6 <- confint(dfr_6)
> all.equal(confint_4, confint_6)
[1] TRUE
> 
> proc.time()
   user  system elapsed 
  23.21    0.34   28.98 
